<!DOCTYPE html>
<html lang="en">
  <head>
    <title> San Antonio Senior Homes </title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <style>
        #map{
        width: 300px;
        height: 300px;
    }
    </style>
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script type="text/javascript"
     src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAt9NmLDjWl_kQngI0jq0BPA3QUXuMQM_I"></script>
    <script src="js/lib/knockout-3.2.0.js"></script>
  </head>
  <body>
    <div id="map"></div>
<input data-bind="value: Lat" />
<input data-bind="value: Lng" />
<div data-bind="latitude: viewModel.Lat, longitude:viewModel.Lng, map:map1" >

</div>
<div class="place-list">
<ul data-bind="foreach:placeList">
        <li data-bind="text:name"></li>
        <li data-bind="text:lat"></li>
        <li data-bind="text:lon"></li>
</ul>
</div>
    <script type='text/javascript'>
    //global for map
var map1;

$(document).ready(function () {

   createMap();
   ko.applyBindings(viewModel);
});

//add the data to be used for generating map markers
var initialPlaces = [
            {
                name:'senior care',
                lat:"29.1",
                lng:"-98.6"
            },
            {
                name:'swimming pool',
                lat:"29.0",
                lng:"-98.4"
            },
            {
                name:'park',
                lat:"29.4",
                lng:"-98.3"
            }
        ];
var Place = function(data) {
            this.name = ko.observable(data.name);
            this.lat = ko.observable(data.lat);
            this.lon = ko.observable(data.lng);
        };

function MyViewModel() {
    var self = this;
    self.Lat = ko.observable('');
    self.Lng = ko.observable('');
    self.placeList=ko.observableArray([]);
    initialPlaces.forEach(function(placeEl) {
        self.placeList.push(new Place(placeEl));
    });
}

    function createMap(){
    var elevator;
   var myOptions = {
        zoom: 3,
        center: new google.maps.LatLng(56, -90),
        mapTypeId: 'terrain'
    };
    map1 = new google.maps.Map($('#map')[0], myOptions);
}

ko.bindingHandlers.map = {
            init: function (element, valueAccessor, allBindingsAccessor, viewModel) {


                var position = new google.maps.LatLng(allBindingsAccessor().latitude(), allBindingsAccessor().longitude());

                var marker = new google.maps.Marker({
                    map: allBindingsAccessor().map,
                    position: position,
                    title: name
                });

                viewModel._mapMarker = marker;
            },
            update: function (element, valueAccessor, allBindingsAccessor, viewModel) {
                var latlng = new google.maps.LatLng(allBindingsAccessor().latitude(), allBindingsAccessor().longitude());
                viewModel._mapMarker.setPosition(latlng);

            }
        };


var viewModel = new MyViewModel();

    </script>
  </body>
</html>